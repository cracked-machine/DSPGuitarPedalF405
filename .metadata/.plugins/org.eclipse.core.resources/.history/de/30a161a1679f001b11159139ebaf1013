/*
 * test_debounce.cpp
 *
 *  Created on: Apr 13, 2021
 *      Author: chris
 */

#include "CppUTest/TestHarness.h"

#include "Debounce.hpp"
#include "test_debounce.h"

//TIM_TypeDef *TIM14 = (TIM_TypeDef*)std::malloc(sizeof(TIM_TypeDef*));
TIM_TypeDef TIM14 = {	CR1 =	0,
						CR2 = 	0,
						SMCR = 	0,
						DIER = 	0,
						SR 	= 	0,
						EGR=    0,
						CCMR1=    0,
						CCMR2=    0,
						CCER=    0,
						CNT=    0,
						PSC=    0,
						ARR=    0,
						RCR=    0,
						CCR1=    0,
						CCR2=    0,
						CCR3=    0,
						CCR4=    0,
						BDTR=    0,
						DCR=    0,
						DMAR=    0,
						OR=    0,
						};

DebounceManager debounceManagerTim14 = {DebounceManager(TIM14, 100)};

TEST_GROUP(DebounceGroup)
{
};

TEST(DebounceGroup, DebounceTest)
{
	bool res = false;
	debounceManagerTim14.start();

	TIM14.CNT = 0;
	res = debounceManagerTim14.check_debounce();
	CHECK(res == false);

	TIM14->CNT = 50;
	res = debounceManagerTim14.check_debounce();
	CHECK(res == false);

	TIM14->CNT = 200;
	res = debounceManagerTim14.check_debounce();
	CHECK(res == true);




}

